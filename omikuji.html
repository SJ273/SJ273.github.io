<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .body {
            text-align: center;
        }
        #random {
            white-space: pre-line;
        }
    </style>
    <title>SJ273のポートフォリオ - おみくじ</title>
</head>
<body>
    <div class="body">
<h2>今日のおみくじ</h2>
<button id="btn" onclick="omikuji()">おみくじを引く</button>

<p id="date"></p>
<p id="result"></p>
<p id="comment"></p>
<p id="message"></p>

<script>
const comments = {
  "超大吉": [
    "すげえええええ！！！！！！！！！！"
  ],
  "大吉": [
    "おめでとう！！！"
  ],
  "中吉": [
    "良きですな"
  ],
  "小吉": [
    "小さなラッキー。"
  ],
  "吉": [
    "今日はいつも通りが一番。"
  ],
  "末吉": [
    "これって良いの？悪いの？"
  ],
  "凶": [
    "ありゃあ…"
  ],
  "大凶": [
    "次は良いもの出てくるよ"
  ],
  "超大凶": [
    "これはむしろラッキー！"
  ]
};

const todayStr = new Date().toDateString();
let timerId = null;

window.onload = function () {
  showTodayDate();

  const savedDay = localStorage.getItem("omikujiDay");
  const savedResult = localStorage.getItem("omikujiResult");

  if (savedDay === todayStr && savedResult) {
    showResult(savedResult);
    lockButton();
    startCountdown();
  }
};

function showTodayDate() {
  const now = new Date();
  document.getElementById("date").textContent =
    `日付：${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日`;
}

function omikuji() {
  const savedDay = localStorage.getItem("omikujiDay");

  if (savedDay === todayStr) {
    document.getElementById("message").textContent =
      "今日はもうおみくじを引いています。";
    return;
  }

  const r = Math.random() * 100;
  let result = "";

if (r < 1) {
  result = "超大吉";
} else if (r < 5) {
  result = "大吉";
} else if (r < 20) {
  result = "中吉";
} else if (r < 40) {
  result = "小吉";
} else if (r < 60) {
  result = "吉";
} else if (r < 75) {
  result = "末吉";
} else if (r < 90) {
  result = "凶";
} else if (r < 98) {
  result = "大凶";
} else {
  result = "超大凶";
}

  localStorage.setItem("omikujiDay", todayStr);
  localStorage.setItem("omikujiResult", result);

  showResult(result);
  lockButton();
  startCountdown();
}

function showResult(result) {
  document.getElementById("result").textContent =
    `今日の運勢：${result}`;

  const list = comments[result];
  const index = Math.floor(Math.random() * list.length);
  document.getElementById("comment").textContent = list[index];

  document.getElementById("message").textContent = "";
}

function lockButton() {
  document.getElementById("btn").disabled = true;
}

function getRemainingTimeText() {
  const now = new Date();
  const tomorrow = new Date();
  tomorrow.setHours(24, 0, 0, 0);

  const diff = tomorrow - now;

  const h = Math.floor(diff / (1000 * 60 * 60));
  const m = Math.floor((diff / (1000 * 60)) % 60);
  const s = Math.floor((diff / 1000) % 60);

  if (diff <= 0) {
    clearInterval(timerId);
    localStorage.clear();
    location.reload();
  }

  return `もう一度引けるまで残り${h}時間${m}分${s}秒`;
}

function startCountdown() {
  if (timerId !== null) return;

  timerId = setInterval(() => {
    document.getElementById("message").textContent =
      getRemainingTimeText();
  }, 1000);
}
</script>
</body>
</html>
