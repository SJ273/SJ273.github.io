<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SJ273のポートフォリオ - 避けるゲーム</title>

<style>
  body {
    text-align: center;
    background: #ddd;
    font-family: sans-serif;
  }

  #game {
    width: 320px;
    height: 480px;
    margin: auto;
    border: 2px solid black;
    position: relative;
    overflow: hidden;
    touch-action: none;

    background-image: url("background.png");
    background-size: cover;
    background-position: center;
  }

  #player {
    width: 50px;
    position: absolute;
    bottom: 10px;
    left: 135px;
    pointer-events: none;
  }

  .enemy {
    width: 40px;
    position: absolute;
    top: -40px;
    pointer-events: none;
  }

  #info {
    font-size: 18px;
    margin-top: 10px;
  }

  /* GAME OVER 画面 */
  #overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
  }

  .over-text {
    color: white;
    text-align: center;
  }

  .over-text p {
    font-size: 32px;
    margin-bottom: 20px;
  }

  .over-text button {
    font-size: 18px;
    padding: 10px 20px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>避けるゲーム</h2>

<div id="game">
  <img id="player" src="pen1_34.gif">

  <div id="overlay">
    <div class="over-text">
      <p>ゲームオーバー</p>
      <button id="retry">もう一度</button>
    </div>
  </div>
</div>

<div id="info">
  スコア: <span id="score">0</span>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const scoreEl = document.getElementById("score");
const overlay = document.getElementById("overlay");
const retryBtn = document.getElementById("retry");

let enemies = [];
let speed = 3;
let score = 0;
let gameOver = false;
let bgY = 0;

/* 敵生成 */
function createEnemy() {
  const e = document.createElement("img");
  e.src = "rock.png";
  e.className = "enemy";
  e.style.left = Math.random() * 280 + "px";
  e.dataset.y = -Math.random() * 300;
  game.appendChild(e);
  enemies.push(e);
}

/* 初期敵 */
for (let i = 0; i < 3; i++) {
  createEnemy();
}

/* プレイヤー移動（マウス＆タッチ） */
function movePlayer(x) {
  const rect = game.getBoundingClientRect();
  let px = x - rect.left - player.offsetWidth / 2;
  px = Math.max(0, Math.min(rect.width - player.offsetWidth, px));
  player.style.left = px + "px";
}

game.addEventListener("mousemove", e => movePlayer(e.clientX));
game.addEventListener("touchmove", e => movePlayer(e.touches[0].clientX));

/* 当たり判定 */
function hit(a, b) {
  const r1 = a.getBoundingClientRect();
  const r2 = b.getBoundingClientRect();
  return (
    r1.left < r2.right &&
    r1.right > r2.left &&
    r1.top < r2.bottom &&
    r1.bottom > r2.top
  );
}

/* メインループ */
function loop() {
  if (gameOver) return;

  /* 背景スクロール */
  bgY += speed / 2;
  game.style.backgroundPosition = `0px ${bgY}px`;

  enemies.forEach(e => {
    let y = Number(e.dataset.y);
    y += speed;
    e.dataset.y = y;
    e.style.top = y + "px";

    if (hit(player, e)) {
      gameOver = true;
      overlay.style.display = "flex";
    }

    if (y > 480) {
      e.dataset.y = -40;
      e.style.left = Math.random() * 280 + "px";

      score++;
      scoreEl.textContent = score;

      if (score % 5 === 0) speed += 0.5;
    }
  });

  requestAnimationFrame(loop);
}

/* リトライ */
retryBtn.addEventListener("click", () => {
  score = 0;
  speed = 3;
  bgY = 0;
  scoreEl.textContent = score;
  gameOver = false;

  enemies.forEach(e => {
    e.dataset.y = -Math.random() * 300;
    e.style.left = Math.random() * 280 + "px";
  });

  overlay.style.display = "none";
  loop();
});

loop();
</script>

</body>
</html>
